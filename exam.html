<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ExamSim โ ูุญุงูู ุงูุงูุชุญุงู</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container exam-container">
    <h1>๐ฏ ExamSim โ ูุญุงูู ุงูุงูุชุญุงู ุงูุทุจู</h1>

    <div id="setup">
      <label>ุงูุณูุฉ:</label>
      <select id="year">
        <option value="1">P1</option>
        <option value="2">P2</option>
        <option value="3">P3</option>
        <option value="4">P4</option>
        <option value="5">P5</option>
        <option value="6">P6</option>
        <option value="7">P7</option>
      </select>

      <label>ุงููุงุฏุฉ:</label>
      <select id="matiere">
        <option value="cardio">Cardiologie</option>
        <option value="anatomie">Anatomie</option>
        <option value="physio">Physiologie</option>
      </select>

      <label>ุนุฏุฏ ุงูุฃุณุฆูุฉ:</label>
      <select id="count">
        <option value="20">20 ุณุคุงู</option>
        <option value="40">40 ุณุคุงู</option>
        <option value="60">60 ุณุคุงู</option>
      </select>

      <label>ุงูููุช:</label>
      <select id="time">
        <option value="30">30 ุฏูููุฉ</option>
        <option value="60">1 ุณุงุนุฉ</option>
        <option value="120">2 ุณุงุนุฉ</option>
      </select>

      <button onclick="startExam()">ุงุจุฏุฃ ุงูุงูุชุญุงู</button>
    </div>

    <div id="exam" class="hidden">
      <div class="timer" id="timer">60:00</div>
      <div class="question-counter" id="counter">ุณุคุงู 1 / 40</div>
      <div id="question"></div>
      <button id="nextBtn" onclick="nextQuestion()">ุงูุชุงูู</button>
    </div>

    <div id="result" class="hidden">
      <h2>๐ ุงูุงูุชุญุงู ุงูุชูู!</h2>
      <p id="resultText"></p>
      <button onclick="generatePDF()">ุชุญููู ุงูุดูุงุฏุฉ</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let questions = [
      {
        q: "Quelle est la paroi cardiaque la plus รฉpaisse ?",
        options: ["A/ Droite","B/ Gauche","C/ Identique"],
        correct: "b"
      },
      {
        q: "Oรน se trouve l'ostium du sinus coronaire ?",
        options: ["A/ Oreillette droite","B/ Oreillette gauche","C/ Ventricule droit"],
        correct: "a"
      }
      // ููููู ุฅููุงู ุญุชู 60 ุณุคุงู
    ];

    let current = 0;
    let correctCount = 0;
    let timeLeft;
    let timerInterval;

    function startExam() {
      const count = parseInt(document.getElementById("count").value);
      const time = parseInt(document.getElementById("time").value);
      timeLeft = time * 60;

      questions = questions.slice(0, count); // ูุฃุฎุฐ ุนุฏุฏ ุงูุฃุณุฆูุฉ ุงููุฎุชุงุฑ

      document.getElementById("setup").classList.add("hidden");
      document.getElementById("exam").classList.remove("hidden");

      loadQuestion();
      updateTimer();
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimer();
        if (timeLeft <= 0) {
          endExam(true);
        }
      }, 1000);
    }

    function loadQuestion() {
      const q = questions[current];
      document.getElementById("counter").textContent = `ุณุคุงู ${current + 1} / ${questions.length}`;
      document.getElementById("question").innerHTML = `
        <div class='question'>
          <p>${q.q}</p>
          <div class='options'>
            ${q.options.map(opt => `<label><input type='radio' name='q' value='${opt[0]}'> ${opt}</label>`).join("")}
          </div>
        </div>
      `;
    }

    function nextQuestion() {
      const val = document.querySelector("input[name='q']:checked")?.value;
      if (!val) return alert("ุงุฎุชุฑ ุฅุฌุงุจุฉ");
      if (val === questions[current].correct) correctCount++;
      current++;
      if (current < questions.length) {
        loadQuestion();
      } else {
        endExam(false);
      }
    }

    function updateTimer() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      document.getElementById("timer").textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function endExam(timeUp) {
      clearInterval(timerInterval);
      document.getElementById("exam").classList.add("hidden");
      document.getElementById("result").classList.remove("hidden");

      const pct = Math.round((correctCount / questions.length) * 100);
      const rank = Math.floor(Math.random() * 50) + 1; // ูุคูุชูุง โ ูุฑุจุทูุง ุจูุงุนุฏุฉ ุจูุงูุงุช ูุงุญููุง

      document.getElementById("resultText").innerHTML = `
        <p><strong>ูุชูุฌุชู:</strong> ${correctCount}/${questions.length} (${pct}%)</p>
        <p><strong>ุฑุชุจุชู:</strong> ${rank} ูู 50 ุทุงูุจ</p>
        ${timeUp ? "<p>โฐ ุงูุชูู ุงูููุช!</p>" : ""}
      `;
    }

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const name = localStorage.getItem("tempName") || "ุทุงูุจ";
      doc.setFontSize(20);
      doc.text("ุดูุงุฏุฉ ุงูุชุญุงู โ ExamSim", 20, 20);
      doc.setFontSize(14);
      doc.text(`ุงูุงุณู: ${name}`, 20, 40);
      doc.text(`ุงููุชูุฌุฉ: ${correctCount}/${questions
